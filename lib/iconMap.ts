// force rebuild 2026-01-15
// lib/iconMap.ts
// Icons live in /public/bingo-icons/*
// Use: getIconForLabel(label) to safely resolve paths even if label has weird spacing/case.

export const ICON_MAP: Record<string, string> = {
  "Trellis net": "/bingo-icons/trellis-net.png",
  "Lollipop": "/bingo-icons/lollipop.png",
  "Defoliate": "/bingo-icons/defoliate.png",
  "Stretch week": "/bingo-icons/stretch-week.png",
  "Dryback": "/bingo-icons/dryback.png",
  "Runoff EC": "/bingo-icons/runoff-ec.png",
  "VPD off": "/bingo-icons/vpd-off.png",
  "Heat stress": "/bingo-icons/heat-stress.png",
  "Light burn": "/bingo-icons/light-burn.png",
  "Herm watch": "/bingo-icons/herm-watch.png",
  "Foxtails": "/bingo-icons/foxtails.png",
  "Amber trichomes": "/bingo-icons/amber-trichomes.png",
  "Cloudy trichomes": "/bingo-icons/cloudy-trichomes.png",
  "Clear trichomes": "/bingo-icons/clear-trichomes.png",
  "Flush debate": "/bingo-icons/flush-debate.png",
  "Fire genetics": "/bingo-icons/fire-genetics.png",
  "Stunted growth": "/bingo-icons/stunted-growth.png",
  "Cal-Mag": "/bingo-icons/cal-mag.png",
  "pH swing": "/bingo-icons/ph-swing.png",
  "pH up": "/bingo-icons/ph-up.png",
  "pH down": "/bingo-icons/ph-down.png",
  "EC up": "/bingo-icons/ec-up.png",
  "EC down": "/bingo-icons/ec-down.png",
  "Overwatered": "/bingo-icons/overwatered.png",
  "Underwatered": "/bingo-icons/underwatered.png",
  "Powdery mildew": "/bingo-icons/powdery-mildew.png",
  "Fungus gnats": "/bingo-icons/fungus-gnats.png",
  "Bud rot": "/bingo-icons/bud-rot.png",
  "Nute lockout": "/bingo-icons/nute-lockout.png",
  "Photos": "/bingo-icons/photos.png",
  "Taco leaves": "/bingo-icons/taco-leaves.png",
  "Leaf claw": "/bingo-icons/leaf-claw.png",
  "Tip burn": "/bingo-icons/tip-burn.png",
  "Nitro tox": "/bingo-icons/nitro-tox.png",
  "Chlorosis": "/bingo-icons/chlorosis.png",
  "Sugar leaf curl": "/bingo-icons/sugar-leaf-curl.png",

  "Cal Def": "/bingo-icons/cal-def.png",
  "Mag Def": "/bingo-icons/mag-def.png",
  "Iron Def": "/bingo-icons/iron-def.png",
  "Potassium Def": "/bingo-icons/potassium-def.png",
  "Phosphorus Def": "/bingo-icons/phosphorus-def.png",
  "Sulfur Def": "/bingo-icons/sulfur-def.png",
  "Zinc Def": "/bingo-icons/zinc-def.png",
  "Manganese Def": "/bingo-icons/manganese-def.png",
  "Boron Def": "/bingo-icons/boron-def.png",
  "Copper Def": "/bingo-icons/copper-def.png",
  "Molybdenum Def": "/bingo-icons/molybdenum-def.png",

  "Root rot": "/bingo-icons/root-rot.png",
  "Slime roots": "/bingo-icons/slime-roots.png",
  "Brown roots": "/bingo-icons/brown-roots.png",
  "White roots": "/bingo-icons/white-roots.png",
  "Pythium": "/bingo-icons/pythium.png",
  "Algae bloom": "/bingo-icons/algae-bloom.png",
  "Biofilm": "/bingo-icons/biofilm.png",
  "Salt buildup": "/bingo-icons/salt-buildup.png",

  "Light leak": "/bingo-icons/light-leak.png",
  "Timer fail": "/bingo-icons/timer-fail.png",
  "Pump fail": "/bingo-icons/pump-fail.png",
  "Air pump fail": "/bingo-icons/air-pump-fail.png",
  "Airstone clogged": "/bingo-icons/airstone-clogged.png",
  "Low oxygen": "/bingo-icons/low-oxygen.png",
  "Water temp high": "/bingo-icons/water-temp-high.png",
  "Water temp low": "/bingo-icons/water-temp-low.png",
  "Drain clog": "/bingo-icons/drain-clog.png",
  "Overflow scare": "/bingo-icons/overflow-scare.png",

  "Res top-off": "/bingo-icons/res-top-off.png",
  "Res change": "/bingo-icons/res-change.png",
  "Water change": "/bingo-icons/water-change.png",
  "Hydro": "/bingo-icons/hydro.png",
  "Soil": "/bingo-icons/soil.png",
  "Aircube": "/bingo-icons/aircube.png",
  "Bubble bucket": "/bingo-icons/bubble-bucket.png",

  "Beneficials": "/bingo-icons/beneficials.png",
  "H2O2 debate": "/bingo-icons/h2o2-debate.png",
  "Silica added": "/bingo-icons/silica-added.png",
  "PK boost": "/bingo-icons/pk-boost.png",
  "KoolBloom week": "/bingo-icons/koolbloom-week.png",

  "Transition": "/bingo-icons/transition.png",
  "Week 3 frost": "/bingo-icons/week-3-frost.png",
  "Week 6 swell": "/bingo-icons/week-6-swell.png",
  "Flower fade": "/bingo-icons/flower-fade.png",
  "Sugar leaves": "/bingo-icons/sugar-leaves.png",
  "Leaf strip": "/bingo-icons/leaf-strip.png",
  "LST": "/bingo-icons/lst.png",
  "Supercrop": "/bingo-icons/supercrop.png",
  "SCROG": "/bingo-icons/scrog.png",
  "Stake support": "/bingo-icons/stake-support.png",
  "Bud stacking": "/bingo-icons/bud-stacking.png",
  "Popcorn buds": "/bingo-icons/popcorn-buds.png",
  "Larf cleanup": "/bingo-icons/larf-cleanup.png",
  "Calyx swell": "/bingo-icons/calyx-swell.png",
  "Pistils orange": "/bingo-icons/pistils-orange.png",
  "Pistils white": "/bingo-icons/pistils-white.png",

  "Loupe check": "/bingo-icons/loupe-check.png",
  "Scope pics": "/bingo-icons/scope-pics.png",
  "Bananas spotted": "/bingo-icons/bananas-spotted.png",
  "Nanner panic": "/bingo-icons/nanner-panic.png",
  "Herm confirmed": "/bingo-icons/herm-confirmed.png",
  "Seed found": "/bingo-icons/seed-found.png",

  "Bud wash": "/bingo-icons/bud-wash.png",
  "Dry trim": "/bingo-icons/dry-trim.png",
  "Wet trim": "/bingo-icons/wet-trim.png",
  "Jar burp": "/bingo-icons/jar-burp.png",
  "Grove bags": "/bingo-icons/grove-bags.png",
  "Hay smell": "/bingo-icons/hay-smell.png",
  "Terp pop": "/bingo-icons/terp-pop.png",
  "Odor control": "/bingo-icons/odor-control.png",
  "Carbon swap": "/bingo-icons/carbon-swap.png",

  "IPM spray": "/bingo-icons/ipm-spray.png",
  "Neem debate": "/bingo-icons/neem-debate.png",
  "Spinosad talk": "/bingo-icons/spinosad-talk.png",
  "Predator mites": "/bingo-icons/predator-mites.png",
  "Ladybugs released": "/bingo-icons/ladybugs-released.png",

  // ✅ Add this when you add the file:
  // public/bingo-icons/sticky-traps.png
  "Sticky traps": "/bingo-icons/sticky-traps.png",
};

function normalizeKey(label: string) {
  return (label || "")
    .trim()
    .replace(/\s+/g, " ")
    // handle smart apostrophes and weird unicode hyphens that can sneak in
    .replace(/[’‘]/g, "'")
    .replace(/[‐-‒–—]/g, "-");
}

let _lowerIndex: Record<string, string> | null = null;

function getLowerIndex() {
  if (_lowerIndex) return _lowerIndex;

  const idx: Record<string, string> = {};
  for (const k of Object.keys(ICON_MAP)) {
    idx[normalizeKey(k).toLowerCase()] = k;
  }

  _lowerIndex = idx;
  return idx;
}

export function getIconForLabel(label: string): string | undefined {
  const norm = normalizeKey(label);

  // exact match first (fast path)
  if (ICON_MAP[norm]) return ICON_MAP[norm];

  // case-insensitive match
  const idx = getLowerIndex();
  const originalKey = idx[norm.toLowerCase()];
  return originalKey ? ICON_MAP[originalKey] : undefined;
}
